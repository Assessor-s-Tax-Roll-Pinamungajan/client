
<div class="land-details" *ngIf="land">
  <div class="header-section">
    <h2>Land Record Details</h2>
    <button mat-raised-button color="primary" (click)="onUpdateDialog(land)" class="update-button">
      Update
    </button>
  </div>
  
  <div class="tax-map-header">
            <p class="index-line">
              <strong>INDEX NO.</strong> <span class="index-value">{{ land.index_no }}</span>
            </p>
            <p class="brgy-section">Brgy. Section</p>
            <p class="pin-section">PIN: 043-33-{{ land.index_no }}- {{ land.assessor_no }}</p>
            <!-- <p >Cancel value: {{ land.cancel }}</p> -->

            <div class="title-block">
              <h1>TAX MAP CONTROL ROLL</h1>
              <div *ngIf="land.cancel_reason" class="cancel-notice">
                <ng-container *ngIf="land.cancel_reason === 'subdivision' && land.cancel_details?.lots?.length > 0; else otherCancel">
                  ⚠️ This record has been marked as <strong>CANCELLED</strong> due to <strong>SUBDIVISION</strong>
                  (
                  <ng-container *ngFor="let lot of land.cancel_details.lots; let last = last">
                    <a [routerLink]="['/land-details', lot.id]">{{ lot.assessor_no }}</a><span *ngIf="!last">, </span>
                  </ng-container>
                  ).
                </ng-container>
                <ng-template #otherCancel>
                  {{ getCancelNotice() }}
                  <ng-container *ngIf="['transfer', 'duplicate', 'consolidate'].includes(land.cancel_reason) && land.cancel_details?.lots?.length > 0">
                    (<ng-container *ngFor="let lot of land.cancel_details.lots; let last = last">
                      <a [routerLink]="['/land-details', lot.id]">{{ lot.assessor_no }}</a><span *ngIf="!last">, </span>
                    </ng-container>).
                  </ng-container>
                </ng-template>
              </div>

    <div >
      <div class="index-value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CEBU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
      <div class="under">PROVINCE/CITY</div>
      <div class="index-value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PINAMUNGAJAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
      <div class="under">MUNICIPALITY/DISTRICT</div>
    </div>

  </div>
</div>

<!-- table -->
  <table class="land-table" [ngClass]="{ 'cancelled-table': land.cancel_reason }">


    <thead>
      <tr>
        <th rowspan="2">Assessors Lot No.</th>
        <th rowspan="2">Cadastral Lot No.</th>
        <th colspan="6">ARP</th>
        <th rowspan="2">Name of Owner</th>
        <th>Title No.</th>
        <th>Area (sq.m.)</th>
        <th rowspan="2">Classification Code</th>
        <th colspan="2">Improvement (Number of Buildings)</th>
        <th rowspan="2">Mch</th> 
        <th rowspan="2">Oth</th>
      </tr>
      <tr class="sub-header">
        <td>A</td>
        <td>B</td>
        <td>C</td>
        <td>D</td>
        <td>E</td>
        <td>F</td>
        <td>#</td>
        <td>#</td>
        <td>/</td>
        <td>/</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ land.assessor_no }}</td>
        <td>{{ land.cadastral_no }}</td>
        <td>{{ land.arp_A }}</td>
        <td>{{ land.arp_B }}</td>
        <td>{{ land.arp_C }}</td>
        <td>{{ land.arp_D }}</td>
        <td>{{ land.arp_E }}</td>
        <td>{{ land.arp_F }}</td>
        <td>{{ land.name_owner }}</td>
        <td>{{ land.title_no }}</td>
        <td>{{ land.area }}</td>
        <td>{{ land.classification_no }}</td>
        <td>{{ land.improvement_1 }}</td>
        <td>{{ land.improvement_2 }}</td>
        <td>{{ land.mch }}</td>
        <td>{{ land.oth }}</td>
      </tr>
    </tbody>
  </table>

  <!-- remarks -->
  <div class="remarks-section" *ngIf="land.remarks && land.remarks.trim() !== ''">
    <!-- <div class="remarks-section"> -->
    <h3>Remarks:</h3>
    <p>{{ land.remarks }}</p>
    

  </div>

  <!-- ✅ Image Display Below the Table -->
  <div style="display: flex; flex-direction: row; align-items: center;">

    <img
      *ngIf="land.barangay && land.index_no && land.assessor_no"
      [src]="'assets/' + land.barangay.toUpperCase() + '/individual_' + land.index_no + '/' + land.assessor_no + '.png'"
      alt="Lot Photo"
      style="display: block;max-width: 70%; margin-left: 16px; justify-content: space-between;"
    />
  </div>
</div>
